---
import { useState } from 'astro';
import Layout from '../layouts/Layout.astro'; // Asumiendo que tienes un layout base

const [posts, setPosts] = useState([]);
const [error, setError] = useState('');
const [loading, setLoading] = useState(true);

useEffect(() => {
  async function fetchPosts() {
    try {
      const response = await fetch('/api/foro/posts');
      if (response.ok) {
        const data = await response.json();
        setPosts(data);
      } else {
        const errorData = await response.json();
        setError(errorData.error || 'Error al cargar las publicaciones');
      }
    } catch (err) {
      console.error('Error de red:', err);
      setError('Error de red al cargar las publicaciones');
    } finally {
      setLoading(false);
    }
  }

  fetchPosts();
}, []);
---

<Layout title="Foro de la Comunidad">
  <main>
    <h1>Foro de la Comunidad</h1>

    {loading && <p>Cargando publicaciones...</p>}
    {error && <p style="color: red;">{error}</p>}

    <ul>
        {posts.map((post: any) => ( // Si no tienes el tipo específico para 'post', usa 'any'
        <li key={post.id}>
          <h2>{post.titulo}</h2>
          <p>{post.contenido}</p>
          <p>Autor ID: {post.id_usuario}</p>
          <p>Fecha: {new Date(post.fecha_creacion).toLocaleDateString()}</p>
        </li>
      ))}
    </ul>

    {/* Posible formulario para crear nuevas publicaciones (si aplica) */}
    {/* <form>
      <h2>Crear nueva publicación</h2>
      <input type="text" placeholder="Título">
      <textarea placeholder="Contenido"></textarea>
      <button type="submit">Publicar</button>
    </form> */}
  </main>
</Layout>